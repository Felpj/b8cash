{
    "openapi": "3.0.0",
    "info": {
      "title": "TCR API",
      "version": "1.0.0",
      "description": "Na TCR é utilizado a autenticação por assinatura de requisição, onde enviamos os dados necessários para autenticação via corpo da requisição e via header.\n\n**Para se autenticar, devemos seguir os seguintes passos:**\n\n1. O primeiro passo é adicionar na requisição dois headers, um chamado `B8-API-KEY` com o valor da sua chave de API da TCR e outro chamado `ACCOUNT-NUMBER`, que é o número da conta + o número do dígito (exemplo: conta 869965 dígito 4, no header colocamos `8699654`).\n\n2. Após adicionar o cabeçalho de autenticação, você precisa juntar em uma estrutura os dados relevantes da requisição que serão usados para gerar a assinatura. Isso inclui:\n    - O corpo (body) da requisição, que pode conter dados enviados pelo cliente (se for uma requisição POST).\n    - Os parâmetros de consulta (query parameters) presentes na URL da requisição.\n\n3. Todos os dados relevantes da requisição (body, query parameters) devem ser combinados em um único objeto.\n\n4. Usando uma biblioteca criptográfica (como o `CryptoJS`), você deve gerar uma assinatura criptográfica HmacSHA512 passando os dados combinados anteriormente e sua `apiSecret` da TCR.\n\n5. A assinatura gerada deve ser adicionada ao corpo (body) da requisição. Além disso, dentro do body também deve ser enviado um `timestamp` gerado.\n\n**Exemplo de estrutura para autenticação em JavaScript (Postman Script):**\n\n```javascript\nconst CryptoJS = require('crypto-js');\n\nfunction buildQuery(obj, prefix) {\n  let str = [];\n  for (let p in obj) {\n    if (obj.hasOwnProperty(p)) {\n      let k = prefix ? prefix + '[' + p + ']' : p;\n      let v = obj[p];\n      str.push((v !== null && typeof v === 'object') ?\n          buildQuery(v, k) :\n          encodeURIComponent(k) + '=' + encodeURIComponent(v));\n    }\n  }\n  return str.join('&');\n}\n\nlet body;\ntry {\n  body = pm.request.body.raw ? JSON.parse(pm.request.body.raw) : {};\n} catch (e) {\n  console.error('Erro ao analisar o corpo da requisição:', e);\n  body = {};\n}\n\nbody.timestamp = Math.floor(Date.now() / 1000);\n\nlet queryParams = {};\nlet urlParts = pm.request.url.toString().split('?');\nif (urlParts.length > 1) {\n  let queryString = urlParts[1];\n  queryString.split('&').forEach(param => {\n      let [key, value] = param.split('=');\n      queryParams[decodeURIComponent(key)] = decodeURIComponent(value || '');\n  });\n}\n\nconst combinedData = { ...body, ...queryParams };\nconst apiSecret = pm.variables.get('apiSecret');\n\ndelete combinedData.signature;\nlet queryString = buildQuery(combinedData);\n\nconsole.log(queryString, 'queryString');\nlet hash = CryptoJS.HmacSHA512(queryString, apiSecret);\nconst signature = CryptoJS.enc.Hex.stringify(hash);\nbody.signature = signature;\npm.request.body.raw = JSON.stringify(body);\npm.variables.set('signature', signature);\n```\n\n"
    },
    "paths": {
      "/sendPix": {
        "post": {
          "summary": "Realiza uma transferência PIX",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "destination": {
                      "type": "object",
                      "properties": {
                        "key": {
                          "type": "string",
                          "description": "Chave PIX do destinatário"
                        }
                      },
                      "required": ["key"]
                    },
                    "amount": {
                      "type": "integer",
                      "description": "Valor da transferência"
                    },
                    "uniqueId": {
                      "type": "string",
                      "description": "Identificador único da transação"
                    }
                  },
                  "required": ["destination", "amount", "uniqueId"]
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Transferência PIX realizada com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "transactionId": "123456789"
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Parâmetros insuficientes"
                  }
                }
              }
            }
          }
        }
      },
      "/sendTed": {
        "post": {
          "summary": "Realiza uma transferência TED",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "destination": {
                      "type": "object",
                      "properties": {
                        "document": {
                          "type": "string",
                          "description": "Documento do destinatário"
                        },
                        "name": {
                          "type": "string",
                          "description": "Nome do destinatário"
                        },
                        "bankNumber": {
                          "type": "string",
                          "description": "Número do banco"
                        },
                        "agencyNumber": {
                          "type": "string",
                          "description": "Número da agência"
                        },
                        "agencyDigit": {
                          "type": "string",
                          "description": "Dígito da agência"
                        },
                        "accountNumber": {
                          "type": "string",
                          "description": "Número da conta"
                        },
                        "accountDigit": {
                          "type": "string",
                          "description": "Dígito da conta"
                        },
                        "accountType": {
                          "type": "string",
                          "description": "Tipo da conta (checking ou saving)"
                        }
                      },
                      "required": ["document", "name", "bankNumber", "accountNumber"]
                    },
                    "amount": {
                      "type": "integer",
                      "description": "Valor da transferência"
                    },
                    "uniqueId": {
                      "type": "string",
                      "description": "Identificador único da transação"
                    }
                  },
                  "required": ["destination", "amount", "uniqueId"]
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Transferência TED realizada com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "transactionId": "987654321"
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Parâmetros insuficientes"
                  }
                }
              }
            }
          }
        }
      },
      "/generatePixKey": {
        "post": {
          "summary": "Gera uma nova chave PIX",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "required": false
          },
          "responses": {
            "200": {
              "description": "Chave PIX gerada com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "pixKey": "chave-pix-gerada"
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao gerar chave PIX"
                  }
                }
              }
            }
          }
        }
      },
      "/createUserAccount": {
        "post": {
          "summary": "Cria uma nova conta de usuário",
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "document": {
                      "type": "string",
                      "description": "Documento do usuário (CPF ou CNPJ)"
                    },
                    "email": {
                      "type": "string",
                      "description": "E-mail do usuário"
                    },
                    "name": {
                      "type": "string",
                      "description": "Nome do usuário"
                    }
                  },
                  "required": ["document", "email", "name"]
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Conta criada com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "userId": "123456"
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao criar conta"
                  }
                }
              }
            }
          }
        }
      },
      "/getTransactions": {
        "post": {
          "summary": "Consulta todas as transações da conta",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "requestBody": {
            "required": false
          },
          "responses": {
            "200": {
              "description": "Transações retornadas com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "transactions": [
                      {
                        "id": "12345",
                        "type": "PIX",
                        "amount": 150.0,
                        "status": "completed"
                      }
                    ]
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao consultar transações"
                  }
                }
              }
            }
          }
        }
      },
      "/getAccountData": {
        "get": {
          "summary": "Consulta informações da conta",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            },
            {
              "name": "document",
              "in": "query",
              "required": false,
              "description": "Documento do titular para consulta específica",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Informações da conta retornadas com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "accountData": {
                      "id": "12345",
                      "name": "João Silva",
                      "balance": 1500.0
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao consultar informações da conta"
                  }
                }
              }
            }
          }
        }
      },
      "/getKeyData": {
        "get": {
          "summary": "Consulta informações de uma chave PIX",
          "parameters": [
            {
              "name": "key",
              "in": "query",
              "required": true,
              "description": "Chave PIX para consulta",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Informações da chave PIX retornadas com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "keyData": {
                      "key": "123e4567-e89b-12d3-a456-426614174000",
                      "type": "email",
                      "owner": "João Silva"
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Erro na solicitação",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Chave PIX não encontrada"
                  }
                }
              }
            }
          }
        }
      },
      "/getAccountPixKeys": {
        "get": {
          "summary": "Consulta todas as chaves PIX da conta",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Chaves PIX retornadas com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "pixKeys": [
                      {
                        "key": "joao@email.com",
                        "type": "email"
                      },
                      {
                        "key": "12345678901",
                        "type": "cpf"
                      }
                    ]
                  }
                }
              }
            },
            "400": {
              "description": "Erro ao buscar chaves PIX",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao buscar chaves PIX"
                  }
                }
              }
            }
          }
        }
      },
      "/getAccountBalance": {
        "get": {
          "summary": "Consulta o saldo da conta",
          "parameters": [
            {
              "name": "account-number",
              "in": "header",
              "required": true,
              "description": "Número da conta do titular",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Saldo da conta retornado com sucesso",
              "content": {
                "application/json": {
                  "example": {
                    "status": "success",
                    "balance": 1500.75
                  }
                }
              }
            },
            "400": {
              "description": "Erro ao consultar saldo",
              "content": {
                "application/json": {
                  "example": {
                    "error": "Erro ao consultar saldo"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  